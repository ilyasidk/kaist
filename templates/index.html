<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Manager - KAIST Project</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #28a745;
        }

        .status-card.error {
            border-left-color: #dc3545;
        }

        .status-card.warning {
            border-left-color: #ffc107;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-indicator.running {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .status-indicator.stopped {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .url-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .info-card h3 {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-card p {
            font-size: 1.2em;
            font-weight: 600;
            color: #212529;
        }

        .log-section {
            background: #212529;
            color: #28a745;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
            border-bottom: 1px solid #343a40;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .timestamp {
            color: #6c757d;
            font-size: 0.8em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Chrome Manager</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –∑–∞–ø—É—Å–∫–æ–º Chrome –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Render</p>
        </div>

        <div class="content">
            <!-- –°—Ç–∞—Ç—É—Å Chrome -->
            <div class="status-card" id="statusCard">
                <h3>
                    <span class="status-indicator" id="statusIndicator"></span>
                    –°—Ç–∞—Ç—É—Å Chrome
                </h3>
                <p id="statusText">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</p>
                <p id="statusDetails"></p>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="control-panel">
                <button class="btn btn-success" onclick="startChrome()">
                    ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å Chrome
                </button>
                <button class="btn btn-danger" onclick="stopChrome()">
                    ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Chrome
                </button>
                <button class="btn btn-warning" onclick="restartChrome()">
                    üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Chrome
                </button>
                <button class="btn btn-primary" onclick="refreshStatus()">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                </button>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ URL -->
            <div class="url-section">
                <h3>üåê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ URL</h3>
                <input type="url" class="url-input" id="urlInput" 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://github.com/ilyasidk/kaist)"
                       value="{{ chrome_url }}">
                <button class="btn btn-primary" onclick="setUrl()">
                    üìù –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π URL
                </button>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="info-grid">
                <div class="info-card">
                    <h3>–¢–µ–∫—É—â–∏–π URL</h3>
                    <p id="currentUrl">{{ chrome_url }}</p>
                </div>
                <div class="info-card">
                    <h3>PID –ø—Ä–æ—Ü–µ—Å—Å–∞</h3>
                    <p id="processPid">-</p>
                </div>
                <div class="info-card">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h3>
                    <p id="lastUpdate">-</p>
                </div>
            </div>

            <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
            <div class="log-section" id="logSection">
                <div class="log-entry">
                    <span class="timestamp">[–ó–∞–≥—Ä—É–∑–∫–∞...]</span> –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
                </div>
            </div>
        </div>
    </div>

    <script>
        let statusInterval;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            statusInterval = setInterval(refreshStatus, 10000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            addLog('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥');
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        async function refreshStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                updateStatusDisplay(data);
                addLog(`–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${data.running ? '–ó–∞–ø—É—â–µ–Ω' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`);
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatusDisplay(data) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const statusCard = document.getElementById('statusCard');
            const currentUrl = document.getElementById('currentUrl');
            const processPid = document.getElementById('processPid');
            const lastUpdate = document.getElementById('lastUpdate');

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
            statusIndicator.className = 'status-indicator ' + (data.running ? 'running' : 'stopped');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
            statusText.textContent = data.running ? 'Chrome –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç' : 'Chrome –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
            statusCard.className = 'status-card ' + (data.running ? '' : 'error');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏
            currentUrl.textContent = data.url || '-';
            processPid.textContent = data.pid || '-';
            lastUpdate.textContent = new Date(data.timestamp).toLocaleString('ru-RU');
        }

        // –ó–∞–ø—É—Å–∫ Chrome
        async function startChrome() {
            const url = document.getElementById('urlInput').value;
            addLog('–ó–∞–ø—É—Å–∫ Chrome...');
            
            try {
                const response = await fetch('/api/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                addLog(data.message);
                
                if (data.success) {
                    setTimeout(refreshStatus, 2000);
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ${error.message}`);
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Chrome
        async function stopChrome() {
            addLog('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ Chrome...');
            
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST'
                });
                
                const data = await response.json();
                addLog(data.message);
                
                if (data.success) {
                    setTimeout(refreshStatus, 1000);
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: ${error.message}`);
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Chrome
        async function restartChrome() {
            addLog('–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Chrome...');
            
            try {
                const response = await fetch('/api/restart', {
                    method: 'POST'
                });
                
                const data = await response.json();
                addLog(data.message);
                
                if (data.success) {
                    setTimeout(refreshStatus, 3000);
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞: ${error.message}`);
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ URL
        async function setUrl() {
            const url = document.getElementById('urlInput').value;
            
            if (!url) {
                addLog('–û—à–∏–±–∫–∞: URL –Ω–µ —É–∫–∞–∑–∞–Ω');
                return;
            }
            
            addLog(`–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ URL: ${url}`);
            
            try {
                const response = await fetch('/api/set_url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                addLog(data.message);
                
                if (data.success) {
                    setTimeout(refreshStatus, 2000);
                }
            } catch (error) {
                addLog(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ URL: ${error.message}`);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addLog(message) {
            const logSection = document.getElementById('logSection');
            const timestamp = new Date().toLocaleTimeString('ru-RU');
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            logSection.appendChild(logEntry);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
            logSection.scrollTop = logSection.scrollHeight;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            const entries = logSection.querySelectorAll('.log-entry');
            if (entries.length > 50) {
                entries[0].remove();
            }
        }
    </script>
</body>
</html> 